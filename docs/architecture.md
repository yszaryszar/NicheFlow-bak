# NicheFlow 前端架构设计文档

## 1. 项目概述

NicheFlow 是一个 AI 驱动的垂直平台内容创作助手，主要面向 TikTok 博主、独立站卖家和短视频创作者。本文档详细说明系统架构设计。

### 1.1 系统定位
- AI 驱动的内容创作平台
- 专注垂直平台内容生成
- 智能化内容优化和管理

### 1.2 架构目标
- 高性能和可扩展性
- 良好的用户体验
- 系统安全可靠
- 便于维护和扩展

## 2. 系统架构

### 2.1 整体架构
```
NicheFlow/
├── 前端服务层
│   ├── 营销站点
│   ├── 用户控制台
│   └── 管理后台
├── 后端服务层
│   ├── API 网关
│   ├── 业务服务
│   └── 基础服务
└── 基础设施层
    ├── 数据存储
    ├── 缓存系统
    └── 消息队列
```

### 2.2 前端架构

#### 路由结构
```
frontend/src/app/
├── (site)/          # 公开页面路由组
│   ├── page.tsx     # 首页
│   ├── pricing/     # 定价页面
│   ├── docs/        # 文档中心
│   └── help/        # 帮助支持
├── auth/            # 认证相关路由
│   ├── login/       # 登录
│   ├── register/    # 注册
│   └── reset/       # 密码重置
└── dashboard/       # 应用功能路由
    ├── page.tsx     # 仪表盘首页
    ├── scripts/     # TikTok脚本管理
    ├── videos/      # 视频生成
    └── settings/    # 用户设置
```

#### 布局结构

##### 营销站点布局 (SiteLayout)
```
Layout:
├── 顶部导航
│   ├── Logo
│   ├── 主导航 (Features, Pricing, About)
│   ├── 主题切换
│   └── 登录/注册按钮
├── 主内容区
│   ├── Hero区域
│   │   ├── 主标题
│   │   ├── 副标题
│   │   ├── CTA按钮
│   │   └── 特色图片/动画
│   ├── 功能展示区
│   │   ├── 功能卡片组
│   │   │   ├── 智能内容生成
│   │   │   ├── 多平台管理
│   │   │   └── 数据分析
│   │   └── 功能详情展示
│   ├── 数据统计区
│   │   ├── 用户数量
│   │   ├── 生成内容数
│   │   └── 平台支持数
│   ├── 产品优势区
│   │   ├── AI驱动
│   │   ├── 多平台支持
│   │   ├── 数据分析
│   │   └── 安全可靠
│   ├── 客户案例区
│   │   ├── 案例展示
│   │   └── 客户评价
│   └── 行动召唤区
│       ├── 标题
│       ├── 描述文本
│       └── 注册按钮
└── 页脚
    ├── 产品信息
    ├── 资源链接
    ├── 帮助支持
    └── 版权信息
```

##### 仪表盘布局 (DashboardLayout)
```
Layout:
├── 侧边栏导航
│   ├── Logo
│   ├── 工作台
│   ├── TikTok脚本
│   ├── 视频生成
│   ├── 设置
│   └── 帮助支持
├── 顶部栏
│   ├── 面包屑导航
│   ├── 主题切换
│   └── 用户菜单
└── 主内容区
    └── 页面内容
```

##### 认证布局 (AuthLayout)
```
Layout:
├── Logo区域
├── 主内容区
│   ├── 标题
│   ├── 表单区域
│   └── 其他选项
└── 页脚链接
```

##### 工作台页面布局
```
Layout:
├── 欢迎区域
│   ├── 用户信息
│   └── 快捷操作
├── 数据概览
│   ├── 内容统计
│   ├── 使用额度
│   └── 订阅状态
├── 快速启动区
│   ├── TikTok脚本生成
│   ├── 亚马逊文案（即将推出）
│   ├── YouTube内容（即将推出）
│   └── 视频/音频（即将推出）
└── 最近活动
    ├── 最近项目
    └── 使用记录
```

#### 组件架构
```
components/
├── ui/             # 基础UI组件
├── layout/         # 布局组件
├── features/       # 功能组件
└── shared/         # 共享组件
```

### 2.3 后端架构

#### 服务划分
- API 网关服务：请求路由、认证、限流
- 用户服务：账号、权限管理
- 内容服务：内容生成、管理
- AI 服务：模型调用、优化
- 分析服务：数据统计、报告

#### 数据架构
```
数据层:
├── PostgreSQL (主数据库)
│   ├── 用户数据
│   ├── 内容数据
│   └── 配置数据
├── Redis (缓存)
│   ├── 会话数据
│   ├── 热点数据
│   └── 计数器
└── MinIO (对象存储)
    ├── 媒体文件
    └── 静态资源
```

## 3. 核心功能架构

### 3.1 内容生成系统
```
ContentGeneration/
├── 模板系统
│   ├── 预设模板
│   └── 自定义模板
├── AI 生成引擎
│   ├── 文本生成
│   ├── 图片生成
│   └── 视频生成
└── 内容优化
    ├── SEO 优化
    ├── 关键词建议
    └── 竞品分析
```

### 3.2 用户系统
```
UserSystem/
├── 认证中心 (Clerk)
│   ├── 社交认证
│   │   ├── Google
│   │   └── GitHub
│   ├── 邮箱认证
│   └── 多语言支持
├── 权限管理
│   ├── 路由保护
│   └── API 保护
└── 用户管理
    ├── 个人信息
    └── 订阅管理
```

### 3.2.1 认证流程
1. 用户访问
   - 检测用户语言
   - 自动切换界面语言
2. 认证方式
   - 社交登录（Google、GitHub）
   - 邮箱密码
3. 路由保护
   - 公开路由：首页、营销页面
   - 受保护路由：仪表盘、设置等
   - API 路由保护

### 3.2.2 技术实现
```typescript
// 路由保护
export const config = {
  matcher: [
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
}

// 用户状态管理
export function useAuth() {
  const { isLoaded, userId, isSignedIn } = useClerkAuth()
  return {
    user: userId,
    isAuthenticated: isSignedIn,
    isLoading: !isLoaded,
  }
}
```

## 4. 技术实现

### 4.1 前端技术栈
- Next.js (应用框架)
- React (UI 框架)
- TanStack Query (数据获取)
- Zustand (状态管理)
- Ant Design (组件库)
- TailwindCSS (样式)

### 4.2 后端技术栈
- Go (开发语言)
- Gin (Web 框架)
- GORM (ORM)
- PostgreSQL (数据库)
- Redis (缓存)
- Docker (容器化)

## 5. 安全架构

### 5.1 应用安全
- JWT 认证
- HTTPS 加密
- CSRF 防护
- XSS 防护
- SQL 注入防护

### 5.2 数据安全
- 数据加密存储
- 访问控制
- 数据备份
- 审计日志

## 6. 性能设计

### 6.1 前端性能
- 路由预加载
- 组件懒加载
- 资源优化
- 缓存策略

### 6.2 后端性能
- 连接池管理
- 缓存机制
- 异步处理
- 负载均衡

## 7. 可用性设计

### 7.1 高可用方案
- 服务冗余
- 故障转移
- 限流熔断
- 监控告警

### 7.2 灾备方案
- 数据备份
- 服务备份
- 应急预案
- 恢复流程

## 8. 扩展性设计

### 8.1 应用扩展
- 微服务架构
- 模块化设计
- 插件系统
- API 版本控制

### 8.2 数据扩展
- 分库分表
- 读写分离
- 数据分片
- 弹性伸缩

## 9. 开发计划

### 9.1 基础架构阶段
- [x] 项目初始化和配置
- [x] 基础布局组件
- [x] 路由结构搭建
- [ ] 状态管理集成
  - [ ] 用户认证状态
  - [ ] 主题管理状态
  - [ ] 全局配置状态
- [ ] API 请求封装
  - [ ] 请求客户端配置
  - [ ] 错误处理机制
  - [ ] 请求拦截器
  - [ ] 响应拦截器

### 9.2 营销站点开发
- [x] 首页开发
  - [x] Hero 区域
  - [x] 功能展示
  - [x] CTA 区域
- [ ] 定价页面
  - [ ] 价格方案展示
  - [ ] 方案对比表
  - [ ] 常见问题
- [ ] 文档中心
  - [ ] 文档导航
  - [ ] 内容展示
  - [ ] 搜索功能
- [ ] 帮助中心
  - [ ] FAQ 系统
  - [ ] 联系表单
  - [ ] 客服集成

### 9.3 认证系统开发
- [ ] Auth.js 集成
  - [ ] 基础配置
  - [ ] 数据库适配器（PostgreSQL）
  - [ ] Session 配置
- [ ] OAuth 提供商集成
  - [ ] Google 登录
  - [ ] GitHub 登录
  - [ ] 自定义提供商
- [ ] 自定义认证页面
  - [ ] 登录页面
  - [ ] 注册页面
  - [ ] 密码重置页面
- [ ] 中间件配置
  - [ ] 路由保护
  - [ ] 角色权限
  - [ ] API 路由保护
- [ ] 用户会话管理
  - [ ] Session 持久化
  - [ ] 会话状态同步
  - [ ] 自动续期

### 9.4 仪表盘开发
- [ ] 工作台
  - [ ] 数据概览
  - [ ] 快速操作
  - [ ] 使用统计
- [ ] TikTok 脚本管理
  - [ ] 脚本生成器
  - [ ] 模板管理
  - [ ] 历史记录
- [ ] 视频生成
  - [ ] 视频编辑器
  - [ ] 素材管理
  - [ ] 导出功能
- [ ] 设置中心
  - [ ] 个人信息
  - [ ] 账号设置
  - [ ] 通知设置

### 9.5 AI 功能集成
- [ ] TikTok 脚本生成
  - [ ] 提示词系统
  - [ ] AI 模型集成
  - [ ] 结果优化
- [ ] 视频内容生成
  - [ ] 场景模板
  - [ ] AI 配音
  - [ ] 自动剪辑

### 9.6 系统优化
- [ ] 性能优化
  - [ ] 代码分割
  - [ ] 资源优化
  - [ ] 缓存策略
- [ ] SEO 优化
  - [ ] Meta 信息
  - [ ] 结构化数据
  - [ ] 站点地图
- [ ] 可访问性
  - [ ] ARIA 标签
  - [ ] 键盘导航
  - [ ] 屏幕阅读

### 9.7 部署和监控
- [ ] 自动化部署
  - [ ] CI/CD 配置
  - [ ] 环境配置
  - [ ] 部署脚本
- [ ] 监控系统
  - [ ] 错误跟踪
  - [ ] 性能监控
  - [ ] 用户分析
- [ ] 日志系统
  - [ ] 日志收集
  - [ ] 告警配置
  - [ ] 分析面板

## 10. 后端开发计划

### 10.1 基础设施搭建
- [ ] 项目结构初始化
  - [ ] 目录结构规划
  - [ ] 依赖管理
  - [ ] 配置管理
- [ ] 开发环境配置
  - [ ] Docker 环境
  - [ ] 数据库配置
  - [ ] Redis 配置
- [ ] 基础框架搭建
  - [ ] Gin 框架集成
  - [ ] 中间件配置
  - [ ] 路由管理
- [ ] 数据库设计
  - [ ] 表结构设计
  - [ ] 索引优化
  - [ ] 迁移管理

### 10.2 核心功能开发
- [ ] 用户认证系统
  - [ ] Auth.js 后端集成
    - [ ] Session 存储（Redis）
    - [ ] 数据库模型
    - [ ] 事件钩子
  - [ ] 自定义认证接口
    - [ ] 用户名密码认证
    - [ ] 邮箱验证
    - [ ] 手机验证码
  - [ ] OAuth2.0 服务
    - [ ] 授权服务
    - [ ] 资源服务
    - [ ] 令牌管理
  - [ ] 安全增强
    - [ ] 密码加密
    - [ ] 登录限流
    - [ ] 异常检测
- [ ] 权限管理系统
  - [ ] RBAC 模型实现
  - [ ] 权限验证中间件
  - [ ] 角色管理接口
- [ ] 内容管理系统
  - [ ] 内容CRUD接口
  - [ ] 分类管理
  - [ ] 标签系统
- [ ] 文件存储系统
  - [ ] MinIO 集成
  - [ ] 文件上传处理
  - [ ] 文件访问控制

### 10.3 AI 服务集成
- [ ] OpenAI 接口集成
  - [ ] API 封装
  - [ ] 错误处理
  - [ ] 响应优化
- [ ] 内容生成服务
  - [ ] 提示词系统
  - [ ] 内容优化
  - [ ] 质量控制
- [ ] 视频处理服务
  - [ ] 视频转码
  - [ ] 视频剪辑
  - [ ] 字幕生成

### 10.4 API 网关开发
- [ ] 请求路由
  - [ ] 路由规则
  - [ ] 服务发现
  - [ ] 负载均衡
- [ ] 安全防护
  - [ ] 认证授权
  - [ ] 限流控制
  - [ ] 防护策略
- [ ] 监控日志
  - [ ] 访问日志
  - [ ] 错误日志
  - [ ] 性能监控

### 10.5 消息队列系统
- [ ] 队列服务搭建
  - [ ] RabbitMQ 配置
  - [ ] 消息模型设计
  - [ ] 错误处理
- [ ] 异步任务处理
  - [ ] 任务调度
  - [ ] 重试机制
  - [ ] 死信处理
- [ ] 实时通知系统
  - [ ] WebSocket 服务
  - [ ] 消息推送
  - [ ] 在线状态管理

### 10.6 性能优化
- [ ] 缓存系统
  - [ ] 缓存策略
  - [ ] 数据一致性
  - [ ] 缓存预热
- [ ] 数据库优化
  - [ ] 查询优化
  - [ ] 连接池管理
  - [ ] 读写分离
- [ ] 并发处理
  - [ ] 协程管理
  - [ ] 资源控制
  - [ ] 性能监控

### 10.7 运维支持
- [ ] 部署配置
  - [ ] Docker 编排
  - [ ] K8s 配置
  - [ ] CI/CD 流程
- [ ] 监控告警
  - [ ] 监控指标
  - [ ] 告警规则
  - [ ] 故障恢复
- [ ] 日志管理
  - [ ] 日志收集
  - [ ] 日志分析
  - [ ] 审计跟踪

## 3. 设计系统

### 3.1 色彩系统

#### 3.1.1 基础色板
```css
:root {
  /* 主题色 */
  --primary: 230 84% 54%;    /* 主色调：现代蓝 */
  --accent: 230 84% 65%;     /* 强调色：亮蓝 */
  
  /* 中性色 */
  --background: 0 0% 100%;   /* 背景色：纯白 */
  --foreground: 230 25% 12%; /* 前景色：深灰 */
  --muted: 230 25% 96%;      /* 柔和色：浅灰 */
  --border: 230 25% 92%;     /* 边框色：淡灰 */
  
  /* 功能色 */
  --destructive: 0 84.2% 60.2%;    /* 危险色：红色 */
  --warning: 38 92% 50%;           /* 警告色：橙色 */
  --success: 142 71% 45%;          /* 成功色：绿色 */
  --info: 200 98% 39%;             /* 信息色：蓝色 */
}

.dark {
  /* 暗色主题 */
  --primary: 230 70% 65%;     /* 更亮的主色调 */
  --accent: 230 70% 75%;      /* 更亮的强调色 */
  --background: 230 30% 11%;  /* 深色背景 */
  --foreground: 230 10% 98%;  /* 浅色文本 */
  --muted: 230 30% 16%;       /* 深灰背景 */
  --border: 230 30% 16%;      /* 深色边框 */
}
```

#### 3.1.2 色彩应用规范

1. 品牌元素
   - Logo 和主要标题：使用 `primary` 色
   - 强调文本：使用渐变效果 `gradient-text`
   - 装饰元素：使用 `accent` 色

2. 界面元素
   - 背景层次：从纯色到渐变背景
   - 卡片效果：磨砂玻璃效果配合阴影
   - 边框和分割线：使用 `border` 色
   - 文本层次：主要文本、次要文本、提示文本

3. 交互状态
   - 默认状态：中性色
   - 悬浮状态：增加不透明度或阴影
   - 激活状态：加深主色调
   - 禁用状态：降低对比度

### 3.2 排版系统

#### 3.2.1 字体家族
```css
{
  /* 系统字体 */
  --font-sans: 'Inter', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
  
  /* 特殊字体 */
  --font-display: 'Cal Sans', sans-serif;
}
```

#### 3.2.2 字体大小
```css
{
  /* 标题系统 */
  --text-h1: 2.5rem;    /* 40px */
  --text-h2: 2rem;      /* 32px */
  --text-h3: 1.5rem;    /* 24px */
  --text-h4: 1.25rem;   /* 20px */
  
  /* 正文系统 */
  --text-base: 1rem;    /* 16px */
  --text-sm: 0.875rem;  /* 14px */
  --text-xs: 0.75rem;   /* 12px */
}
```

### 3.3 视觉效果

#### 3.3.1 阴影系统
```css
{
  /* 基础阴影 */
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.1);
  
  /* 特殊效果 */
  --shadow-glow: 0 0 30px rgba(var(--primary), 0.2);
}
```

#### 3.3.2 特效样式

1. 磨砂玻璃效果
```css
.glass {
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(16px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}
```

2. 渐变效果
```css
.gradient-text {
  background: linear-gradient(135deg, var(--primary), var(--accent));
  -webkit-background-clip: text;
  color: transparent;
}
```

3. 悬浮动画
```css
.hover-effect {
  transition: all 0.3s ease;
  &:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }
}
```

### 3.4 组件设计

#### 3.4.1 卡片组件
- 使用磨砂玻璃效果
- 柔和圆角 (border-radius: 12px)
- 渐变边框
- 悬浮动画效果

#### 3.4.2 按钮系统
- 主要按钮：实心背景 + 白色文本
- 次要按钮：透明背景 + 边框
- 图标按钮：圆形或方形
- 统一悬浮效果

#### 3.4.3 表单元素
- 输入框：简洁边框 + 聚焦效果
- 选择器：自定义下拉样式
- 复选框：动画过渡效果
- 统一错误状态样式

### 3.5 响应式设计

#### 3.5.1 断点系统
```css
{
  --screen-sm: 640px;
  --screen-md: 768px;
  --screen-lg: 1024px;
  --screen-xl: 1280px;
  --screen-2xl: 1536px;
}
```

#### 3.5.2 栅格系统
- 12列网格系统
- 响应式间距
- 自适应容器
- 弹性布局

### 3.6 动画系统

#### 3.6.1 过渡效果
```css
{
  --transition-base: all 0.3s ease;
  --transition-fast: all 0.15s ease;
  --transition-slow: all 0.5s ease;
}
```

#### 3.6.2 动画类型
1. 页面切换动画
2. 组件进入/退出动画
3. 交互反馈动画
4. 加载动画

### 3.7 可访问性

#### 3.7.1 对比度要求
- 正文文本：最小对比度 4.5:1
- 大号文本：最小对比度 3:1
- 装饰性元素：无最低要求

#### 3.7.2 键盘导航
- 焦点状态清晰可见
- Tab 键顺序合理
- 快捷键支持

#### 3.7.3 屏幕阅读器
- 语义化 HTML
- ARIA 标签
- 图片替代文本

### 3.8 主题切换

#### 3.8.1 亮色主题
- 纯白背景
- 高对比度文本
- 柔和阴影
- 浅色边框

#### 3.8.2 暗色主题
- 深色背景
- 柔和文本
- 强化阴影
- 发光效果

### 3.9 设计规范

#### 3.9.1 布局原则
- 统一间距系统
- 对齐准则
- 层次分明
- 留白得当

#### 3.9.2 交互原则
- 即时反馈
- 渐进式动画
- 容错设计
- 清晰提示

#### 3.9.3 视觉原则
- 简洁现代
- 层次分明
- 重点突出
- 一致性强